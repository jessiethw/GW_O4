''' Script for calculating latency contributions/breakdown for O3

    Author: Jessie Thwaites
    Date:   July 2022
'''  

import numpy as np
import matplotlib
import lxml.etree
import matplotlib.pyplot as plt
from astropy.time import Time

O3_list = ['S190408an','S190412m','S190421ar','S190425z','S190426c','S190503bf','S190510g','S190512at',
           'S190513bm','S190517h','S190519bj','S190521g','S190521r','S190602aq','S190630ag',
           'S190701ah','S190706ai','S190707q','S190718y','S190720a','S190727h','S190728q',
           'S190814bv','S190828j','S190828l','S190901ap','S190910d','S190910h', 'S190915ak',
           'S190923y','S190924h','S190930s','S190930t','S191105e','S191109d','S191129u',
           'S191204r','S191205ah','S191213g','S191215w','S191216ap','S191222n','S200105ae',
           'S200112r','S200114f','S200115j','S200128d','S200129m','S200208q','S200213t',
           'S200219ac','S200224ca','S200225q','S200302c','S200311bg','S200316bj']

trigger_times = []
lvc_gcn_times=[]
for gw in O3_list:
    with open('/home/rhussain/icecube/scripts/GW_study/realtime_gw/trunk/gcn_notices/%s.xml' % gw, 
                'rb').read() as payload:
    #payload = open('/home/rhussain/icecube/scripts/GW_study/realtime_gw/trunk/gcn_notices/%s.xml' % gw, 
    #            'rb').read()
        root = lxml.etree.fromstring(payload)

        isot = root.find('.//ISOTime').text
        lvc_t= root.find('.//Date').text

        trigger_times.append(isot)
        lvc_gcn_times.append(lvc_t)

dates = ['2019-04-08T','2019-04-12T','2019-04-22T','2019-04-25T','2019-04-26T',
         '2019-05-03T','2019-05-10T','2019-05-12T','2019-05-13T','2019-05-17T',
         '2019-05-19T','2019-05-21T','2019-05-21T','2019-06-02T','2019-06-30T',
         '2019-07-01T','2019-07-06T','2019-07-07T','2019-07-18T','2019-07-20T','2019-07-27T',
         '2019-07-28T','2019-08-14T','2019-08-28T','2019-08-28T','2019-09-02T',
         '2019-09-10T','2019-09-10T','2019-09-16T','2019-09-23T','2019-09-24T',
         '2019-09-30T','2019-09-30T','2019-11-05T','2019-11-09T','2019-11-29T',
         '2019-12-04T','2019-12-05T','2019-12-13T','2019-12-15T','2019-12-16T',
         '2019-12-22T','2020-01-05T','2020-01-12T','2020-01-14T','2020-01-15T',
         '2020-01-28T','2020-01-29T','2020-02-08T','2020-02-13T','2020-02-19T',
         '2020-02-24T','2020-02-25T','2020-03-02T','2020-03-11T','2020-03-16T']

time = ['21:14:21','11:35:09','17:53:48','12:33:48','16:04:02','19:50:43','04:58:21',
        '19:08:15','22:18:49','08:44:30','17:19:36','03:23:13','08:42:39','18:31:55',
        '19:26:39','21:12:46','23:00:50','10:27:01','15:51:47','01:58:20','06:29:06','07:27:06',
        '22:06:41','10:57:01','11:11:45','00:13:09','01:52:35','09:44:09','00:28:14',
        '13:39:22','03:01:57','14:37:28','15:05:09','18:24:03','03:02:00','14:43:21',
        '18:55:26','22:25:38','05:04:48','22:51:14','23:52:37','04:09:01','22:28:10',
        '16:33:11','02:51:01','05:28:30','02:52:42','08:08:31','13:36:29','04:40:26',
        '13:53:49','22:53:09','13:39:45','02:23:37','12:28:49','23:03:58']

gcn = np.core.defchararray.add(dates, time)
ic_gcn_times = Time(gcn,format='isot',scale='utc')

print(trigger_times)
print(lvc_gcn_times)
print(ic_gcn_times)